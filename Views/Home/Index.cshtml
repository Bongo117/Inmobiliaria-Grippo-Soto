@model Inmobiliaria_.Net_Core.Models.DashboardViewModel
@{
    ViewData["Title"] = "Dashboard";
}

<div class="text-center">
    <h1 class="display-4 welcome-title">Bienvenido a Inmobiliaria GriSoto</h1>
</div>

<!-- Estadísticas -->
<div class="row text-start g-4 mb-4">
    <!-- Columna de Estadísticas -->
    <div class="col-lg-4">
        <div class="card dashboard-card card-disponibles mb-4">
            <div class="card-body">
                <div class="dashboard-card-icon"><i class="fas fa-home"></i></div>
                <h5 class="card-title text-muted">Inmuebles Disponibles</h5>
                <p class="card-text display-4 fw-bold text-dark">@Model.InmueblesDisponibles</p>
            </div>
        </div>
        <div class="card dashboard-card card-contratos mb-4">
            <div class="card-body">
                <div class="dashboard-card-icon"><i class="fas fa-file-signature"></i></div>
                <h5 class="card-title text-muted">Contratos Vigentes</h5>
                <p class="card-text display-4 fw-bold text-dark">@Model.ContratosVigentes</p>
            </div>
        </div>
        <div class="card dashboard-card card-inquilinos mb-4">
            <div class="card-body">
                <div class="dashboard-card-icon"><i class="fas fa-users"></i></div>
                <h5 class="card-title text-muted">Inquilinos Activos</h5>
                <p class="card-text display-4 fw-bold text-dark">@Model.InquilinosActivos</p>
            </div>
        </div>
        <div class="card dashboard-card card-propietarios mb-4">
            <div class="card-body">
                <div class="dashboard-card-icon"><i class="fas fa-user-tie"></i></div>
                <h5 class="card-title text-muted">Propietarios Activos</h5>
                <p class="card-text display-4 fw-bold text-dark">@Model.PropietariosActivos</p>
            </div>
        </div>
    </div>

    <!-- Columna de Gráfico -->
    <div class="col-lg-8 d-flex flex-column">
        <div class="card">
            <div class="card-header">
                <h4>Estado de Inmuebles</h4>
            </div>
            <div class="card-body d-flex align-items-center justify-content-center" style="position: relative;">
                <div style="max-height: 550px; width: 100%;">
                    <canvas id="inmueblesChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Accesos Rápidos y Contratos por Vencer -->
<div class="row text-start g-4">
    <div class="col-lg-4">
        <div class="card h-100">
            <div class="card-header">
                <h4>Accesos Rápidos</h4>
            </div>
            <div class="list-group list-group-flush">
                <a asp-controller="Contratos" asp-action="Crear" class="list-group-item list-group-item-action text-center">
                    <i class="fas fa-file-signature me-2"></i> Nuevo Contrato
                </a>
                <a asp-controller="Inmueble" asp-action="Crear" class="list-group-item list-group-item-action text-center">
                    <i class="fas fa-home me-2"></i> Nuevo Inmueble
                </a>
                <a asp-controller="Inquilino" asp-action="Crear" class="list-group-item list-group-item-action text-center">
                    <i class="fas fa-user-plus me-2"></i> Nuevo Inquilino
                </a>
                <a asp-controller="Propietario" asp-action="Crear" class="list-group-item list-group-item-action text-center">
                    <i class="fas fa-user-tie me-2"></i> Nuevo Propietario
                </a>
            </div>
        </div>
    </div>
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header">
                <h4><i class="fas fa-hourglass-end me-2 text-warning"></i>Contratos por Vencer (Próximos 30 días)</h4>
            </div>
            <div class="card-body">
                @if (Model.ContratosPorVencer.Any())
                {
                    <ul class="list-group">
                        @foreach (var contrato in Model.ContratosPorVencer)
                        {
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <div>
                                    <strong>Inmueble:</strong> @contrato.Inmueble?.Direccion <br>
                                    <small class="text-muted">Inquilino: @contrato.Inquilino?.Nombre @contrato.Inquilino?.Apellido</small>
                                </div>
                                <div>
                                    <span class="badge bg-warning text-dark">Vence: @contrato.FechaFin.ToString("dd/MM/yyyy")</span>
                                    <a asp-controller="Contratos" asp-action="Detalles" asp-route-id="@contrato.Id" class="btn btn-sm btn-outline-primary ms-2">Ver</a>
                                </div>
                            </li>
                        }
                    </ul>
                }
                else
                {
                    <p class="text-muted">No hay contratos que venzan en los próximos 30 días.</p>
                }
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const ctx = document.getElementById('inmueblesChart').getContext('2d');
            const disponibles = @Model.InmueblesDisponibles;
            const ocupados = @Model.InmueblesOcupados;

            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Disponibles', 'Ocupados'],
                    datasets: [{
                        label: 'Estado de Inmuebles',
                        data: [disponibles, ocupados],
                        backgroundColor: [
                            'rgba(25, 135, 84, 0.7)', // Verde (Success)
                            'rgba(255, 193, 7, 0.7)'  // Amarillo (Warning)
                        ],
                        borderColor: [
                            'rgba(25, 135, 84, 1)',
                            'rgba(255, 193, 7, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'top' }
                    }
                }
            });
        });
    </script>
}