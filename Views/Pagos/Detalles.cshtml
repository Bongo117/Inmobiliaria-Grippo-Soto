@model Inmobiliaria_.Net_Core.Models.Pago

@{
    ViewData["Title"] = "Detalles del Pago";
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>Detalles del Pago</h2>
    <div>
        <a asp-action="Index" class="btn btn-secondary me-2">
            <i class="fas fa-list"></i> Lista de Pagos
        </a>
        @if (Model.Contrato != null)
        {
            <a asp-action="PorContrato" asp-route-contratoId="@Model.Contrato.Id" class="btn btn-outline-info">
                <i class="fas fa-file-contract"></i> Pagos del Contrato
            </a>
        }
    </div>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h4>Información del Pago</h4>
                <div>
                    @if (Model.Estado)
                    {
                        <span class="badge bg-success fs-6">ACTIVO</span>
                    }
                    else
                    {
                        <span class="badge bg-danger fs-6">ANULADO</span>
                    }
                </div>
            </div>
            <div class="card-body">
                
                <div class="row mb-3">
                    <div class="col-md-6">
                        <h6 class="text-muted">Número de Pago</h6>
                        <p class="h5 text-primary">@Model.NumeroPago</p>
                    </div>
                    <div class="col-md-6">
                        <h6 class="text-muted">Fecha de Pago</h6>
                        <p class="h5">@Model.FechaPago.ToString("dd/MM/yyyy")</p>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <h6 class="text-muted">Importe</h6>
                        <p class="h4 text-success">$@Model.Importe.ToString("N2")</p>
                    </div>
                    <div class="col-md-6">
                        <h6 class="text-muted">Estado</h6>
                        <p>
                            @if (Model.Estado)
                            {
                                <span class="badge bg-success">Activo</span>
                            }
                            else
                            {
                                <span class="badge bg-danger">Anulado</span>
                            }
                        </p>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-12">
                        <h6 class="text-muted">Detalle / Concepto</h6>
                        <p class="lead">@Model.Detalle</p>
                    </div>
                </div>

                <hr>

                @if (User.IsInRole("Administrador"))
                {
                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="text-muted">Fecha de Creación</h6>
                            <p>@Model.FechaCreacion.ToString("dd/MM/yyyy HH:mm:ss")</p>
                            @if (!string.IsNullOrEmpty(Model.UsuarioCreador))
                            {
                                <h6 class="text-muted">Creado por</h6>
                                <p>@Model.UsuarioCreador</p>
                            }
                        </div>
                        <div class="col-md-6">
                            @if (!Model.Estado && Model.FechaAnulacion.HasValue)
                            {
                                <h6 class="text-muted">Fecha de Anulación</h6>
                                <p class="text-danger">@Model.FechaAnulacion.Value.ToString("dd/MM/yyyy HH:mm:ss")</p>
                                @if (!string.IsNullOrEmpty(Model.UsuarioAnulacion))
                                {
                                    <h6 class="text-muted">Anulado por</h6>
                                    <p class="text-danger">@Model.UsuarioAnulacion</p>
                                }
                            }
                        </div>
                    </div>
                }

            </div>
        </div>

        @if (Model.Contrato != null)
        {
            <div class="card mt-4">
                <div class="card-header">
                    <h5><i class="fas fa-file-contract"></i> Información del Contrato</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="text-muted">ID del Contrato</h6>
                            <p>@Model.Contrato.Id</p>
                            
                            <h6 class="text-muted">Inmueble</h6>
                            <p>@Model.Contrato.Inmueble?.Direccion</p>
                            @if (!string.IsNullOrEmpty(Model.Contrato.Inmueble?.Tipo))
                            {
                                <small class="text-muted">Tipo: @Model.Contrato.Inmueble.Tipo</small>
                            }
                        </div>
                        <div class="col-md-6">
                            <h6 class="text-muted">Inquilino</h6>
                            <p>@(Model.Contrato.Inquilino?.Apellido + ", " + Model.Contrato.Inquilino?.Nombre)</p>
                            
                            <h6 class="text-muted">Período del Contrato</h6>
                            <p>@Model.Contrato.FechaInicio.ToString("dd/MM/yyyy") - @Model.Contrato.FechaFin.ToString("dd/MM/yyyy")</p>
                            
                            <h6 class="text-muted">Monto Mensual</h6>
                            <p class="text-success">$@Model.Contrato.MontoMensual.ToString("N2")</p>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>

    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5>Acciones</h5>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    @if (Model.Estado)
                    {
                        <a asp-action="Editar" asp-route-id="@Model.Id" class="btn-custom btn-secondary-custom">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 256 256">
                                <path d="M227.31,73.37,182.63,28.69a16,16,0,0,0-22.63,0L36.69,152A15.86,15.86,0,0,0,32,163.31V208a16,16,0,0,0,16,16H92.69A15.86,15.86,0,0,0,104,219.31l83.67-83.66,3.48,13.9L173.27,216H216a16,16,0,0,0,16-16V163.31A15.86,15.86,0,0,0,227.31,152ZM51.31,188,68,171.31,84.69,188Zm48,0L120,171.31,136.69,188Zm48-48L168,123.31,184.69,140Zm16-57.37L147.32,64l16.68-16.69L180.69,66.34Z"/>
                            </svg>
                            <span class="ms-2">Editar Pago</span>
                        </a>
                        @if (User.IsInRole("Administrador"))
                        {
                            <a asp-action="Anular" asp-route-id="@Model.Id" class="btn-custom btn-outline-custom" 
                               style="color: #dc2626; border-color: #dc2626;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 256 256">
                                <path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216ZM149.66,93.66a8,8,0,0,1,0,11.32L139.31,115.31l10.35,10.35a8,8,0,0,1-11.32,11.32L128,126.63l-10.34,10.35a8,8,0,0,1-11.32-11.32L116.69,115.31,106.34,105a8,8,0,0,1,11.32-11.32L128,104l10.34-10.34A8,8,0,0,1,149.66,93.66Z"/>
                            </svg>
                            <span class="ms-2">Anular Pago</span>
                        </a>
                        }
                    }
                    @if (User.IsInRole("Administrador"))
                    {
                        <a asp-action="Eliminar" asp-route-id="@Model.Id" class="btn btn-danger" onclick="return confirm('Esta acción eliminará permanentemente el pago. No se verá como Anulado, desaparecerá del sistema. ¿Desea continuar?');">
                            <i class="fas fa-trash-alt"></i> Eliminar Permanentemente
                        </a>
                    }
                    else
                    {
                        <div class="alert alert-warning">
                            <small><i class="fas fa-info-circle"></i> Este pago está anulado y no puede ser editado.</small>
                        </div>
                    }
                    
                    <hr>
                    
                    <a asp-action="Index" class="btn-custom btn-ghost-custom">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 256 256">
                            <path d="M224,48H32a8,8,0,0,0-8,8V200a8,8,0,0,0,8,8H224a8,8,0,0,0,8-8V56A8,8,0,0,0,224,48ZM40,64H216V192H40ZM56,80a8,8,0,0,1,8-8H80a8,8,0,0,1,0,16H64A8,8,0,0,1,56,80Zm0,32a8,8,0,0,1,8-8H80a8,8,0,0,1,0,16H64A8,8,0,0,1,56,112Zm0,32a8,8,0,0,1,8-8H80a8,8,0,0,1,0,16H64A8,8,0,0,1,56,144Z"/>
                        </svg>
                        <span class="ms-2">Lista de Pagos</span>
                    </a>
                    
                    @if (Model.Contrato != null)
                    {
                        <a asp-action="PorContrato" asp-route-contratoId="@Model.Contrato.Id" class="btn-custom btn-outline-custom">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 256 256">
                                <path d="M224,48H32a8,8,0,0,0-8,8V200a8,8,0,0,0,8,8H224a8,8,0,0,0,8-8V56A8,8,0,0,0,224,48ZM40,64H216V192H40ZM56,80a8,8,0,0,1,8-8H80a8,8,0,0,1,0,16H64A8,8,0,0,1,56,80Zm0,32a8,8,0,0,1,8-8H80a8,8,0,0,1,0,16H64A8,8,0,0,1,56,112Zm0,32a8,8,0,0,1,8-8H80a8,8,0,0,1,0,16H64A8,8,0,0,1,56,144Z"/>
                            </svg>
                            <span class="ms-2">Pagos del Contrato</span>
                        </a>
                        
                        <a asp-controller="Contratos" asp-action="Detalles" asp-route-id="@Model.Contrato.Id" class="btn-custom btn-outline-custom">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 256 256">
                                <path d="M247.31,124.76c-.35-.79-8.82-19.58-27.65-38.41C194.57,61.26,162.88,48,128,48S61.43,61.26,36.34,86.35C17.51,105.18,9,124,8.69,124.76a8,8,0,0,0,0,6.5c.35.79,8.82,19.57,27.65,38.4C61.43,194.74,93.12,208,128,208s66.57-13.26,91.66-38.34c18.83-18.83,27.3-37.61,27.65-38.4A8,8,0,0,0,247.31,124.76ZM128,192c-30.78,0-57.67-11.19-79.93-33.25A133.47,133.47,0,0,1,25,128,133.33,133.33,0,0,1,48.07,97.25C70.33,75.19,97.22,64,128,64s57.67,11.19,79.93,33.25A133.46,133.46,0,0,1,231.05,128C223.84,141.46,192.43,192,128,192Zm0-112a48,48,0,1,0,48,48A48.05,48.05,0,0,0,128,80Zm0,80a32,32,0,1,1,32-32A32,32,0,0,1,128,160Z"/>
                            </svg>
                            <span class="ms-2">Ver Contrato</span>
                        </a>
                        
                        <a asp-action="Crear" asp-route-contratoId="@Model.Contrato.Id" class="btn-custom btn-primary-custom">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 256 256">
                                <path d="M224,128a8,8,0,0,1-8,8H136v80a8,8,0,0,1-16,0V136H40a8,8,0,0,1,0-16h80V40a8,8,0,0,1,16,0v80h80A8,8,0,0,1,224,128Z"/>
                            </svg>
                            <span class="ms-2">Nuevo Pago</span>
                        </a>
                    }
                </div>
            </div>
        </div>

        <div class="card mt-3">
            <div class="card-header">
                <h6><i class="fas fa-info-circle"></i> Información</h6>
            </div>
            <div class="card-body">
                <ul class="list-unstyled mb-0">
                    <li><small>• Los pagos registrados quedan como constancia permanente</small></li>
                    <li><small>• Solo se puede editar el detalle/concepto</small></li>
                    <li><small>• Los pagos anulados no pueden ser editados</small></li>
                    <li><small>• La anulación es irreversible</small></li>
                </ul>
            </div>
        </div>
    </div>
</div>
